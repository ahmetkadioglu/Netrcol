<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1200, initial-scale=1">
    <title><%= guild.name %> | <%= config.title %></title>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #818cf8; --secondary: #c084fc; 
            --bg: #0f1016; --surface: #1e1f29; 
            --text: #ffffff; --text-muted: #cbd5e1; 
            --border: rgba(255, 255, 255, 0.2); 
            --sidebar-width: 280px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Outfit', sans-serif; display: flex; min-height: 100vh; overflow-x: hidden; min-width: 1200px; }
        ::-webkit-scrollbar { width: 10px; } ::-webkit-scrollbar-track { background: var(--bg); } ::-webkit-scrollbar-thumb { background: #333; border-radius: 5px; }

        /* --- SIDEBAR (SABÄ°T) --- */
        .sidebar { width: var(--sidebar-width); height: 100vh; position: fixed; top: 0; left: 0; background: #13141c; border-right: 1px solid var(--border); padding: 30px 20px; display: flex; flex-direction: column; gap: 5px; z-index: 100; overflow-y: auto; }
        .server-profile { display: flex; align-items: center; gap: 15px; padding-bottom: 20px; border-bottom: 1px solid var(--border); margin-bottom: 15px; flex-shrink: 0; }
        .server-icon { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--primary); object-fit: cover; }
        .server-icon-placeholder { width: 45px; height: 45px; border-radius: 50%; background: var(--surface); display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid var(--primary); }
        .server-name { font-weight: 700; font-size: 1rem; color: white; }
        .menu-label { color: #94a3b8; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin: 20px 10px 10px; font-weight: 800; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 15px; color: #cbd5e1; text-decoration: none; border-radius: 10px; transition: 0.2s; font-weight: 600; font-size: 0.95rem; }
        .nav-item:hover { background: rgba(255,255,255,0.1); color: white; transform: translateX(5px); }
        .nav-item.active { background: linear-gradient(90deg, rgba(99, 102, 241, 0.2), transparent); color: var(--primary); border-left: 3px solid var(--primary); }
        .back-btn { margin-top: auto; background: rgba(255,255,255,0.1); color: white; justify-content: center; margin-bottom: 20px; }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); width: calc(100% - var(--sidebar-width)); padding: 40px 60px; min-width: 900px; }
        
        /* Header */
        .module-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid var(--border); }
        .header-left { display: flex; align-items: center; gap: 25px; }
        .header-icon { width: 70px; height: 70px; background: #252630; color: var(--primary); border: 2px solid rgba(99, 102, 241, 0.3); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 2rem; }
        .header-text h1 { font-size: 2.2rem; font-weight: 800; color: white; margin-bottom: 5px; }
        .header-text p { color: #cbd5e1; font-size: 1rem; }
        .user-pill { display: flex; align-items: center; gap: 15px; background: #1e1f29; border: 1px solid var(--border); padding: 10px 20px; border-radius: 12px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary); }
        .user-name { font-weight: 700; font-size: 1rem; color: white; }
        .save-btn { background: #10b981; color: white; padding: 12px 35px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 10px; font-size: 1rem; box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3); }
        .save-btn:hover { background: #059669; transform: translateY(-2px); }

        /* KART YAPISI (DÃœZELTÄ°LDÄ°) */
        .settings-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px; --c1: 99, 102, 241; --c2: 168, 85, 247; --c3: 236, 72, 153; --c4: 16, 185, 129; }
        .setting-card:nth-child(4n+1) { --theme: var(--c1); }
        .setting-card:nth-child(4n+2) { --theme: var(--c2); }
        .setting-card:nth-child(4n+3) { --theme: var(--c3); }
        .setting-card:nth-child(4n+4) { --theme: var(--c4); }
        
        .setting-card { background: #1e1f29; border: 1px solid rgba(255,255,255,0.1); border-top: 3px solid rgb(var(--theme)); padding: 30px; border-radius: 20px; transition: all 0.3s ease; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .setting-card:hover { transform: translateY(-5px); background: #23242e; box-shadow: 0 10px 30px rgba(0,0,0,0.4); border-color: rgba(255,255,255,0.2); }

        .form-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 5px; }
        .form-label { font-weight: 700; color: white; font-size: 1rem; }
        .form-input, .form-select, .form-textarea { background: #13141c; border: 1px solid rgba(255,255,255,0.2); color: white; padding: 15px; border-radius: 10px; font-family: 'Outfit', sans-serif; font-size: 1rem; outline: none; transition: 0.3s; width: 100%; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: rgb(var(--theme)); background: #0f1016; box-shadow: 0 0 10px rgba(var(--theme), 0.2); }
        .form-textarea { resize: vertical; min-height: 100px; }
        
        /* Toggle Switch */
        .toggle-wrapper { display: flex; justify-content: space-between; align-items: center; }
        .switch { position: relative; display: inline-block; width: 55px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #10b981; }
        input:checked + .slider:before { transform: translateX(27px); }

        /* Emoji ve Modal CSS (AynÄ±) */
        .input-with-emoji { position: relative; width: 100%; } .input-with-emoji input, .input-with-emoji textarea { padding-right: 45px; }
        .emoji-trigger-btn { position: absolute; right: 12px; top: 12px; background: none; border: none; color: #94a3b8; font-size: 1.3rem; cursor: pointer; transition: 0.3s; } .emoji-trigger-btn:hover { color: white; }
        .emoji-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: none; align-items: center; justify-content: center; } .emoji-modal-overlay.active { display: flex; }
        .emoji-modal { background: #1e1f29; width: 90%; max-width: 450px; height: 500px; border-radius: 20px; border: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .emoji-header { background: #13141c; padding: 15px; border-bottom: 1px solid var(--border); display: flex; gap: 10px; }
        .emoji-tab { flex: 1; background: transparent; border: none; color: #94a3b8; padding: 10px; font-weight: 700; cursor: pointer; border-radius: 8px; transition: 0.3s; }
        .emoji-tab.active { background: var(--primary); color: white; }
        .close-emoji-btn { background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; padding: 0 10px; }
        .emoji-content { flex: 1; overflow-y: auto; padding: 15px; }
        .emoji-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap: 10px; }
        .emoji-item { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 1.5rem; background: rgba(255,255,255,0.05); } .emoji-item:hover { background: rgba(255,255,255,0.15); } .emoji-item img { width: 32px; height: 32px; object-fit: contain; }
        optgroup { background: #1e1f29; color: #94a3b8; } option { background: #0f1016; color: white; padding: 10px; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="server-profile">
            <% if (guild.icon) { %> <img src="https://cdn.discordapp.com/icons/<%= guild.id %>/<%= guild.icon %>.webp" class="server-icon"> <% } else { %> <div class="server-icon-placeholder"><%= guild.name.charAt(0) %></div> <% } %>
            <div class="server-name"><%= guild.name %></div>
        </div>

        <span class="menu-label">Management</span>
        <a href="/dashboard/<%= guild.id %>" class="nav-item"><i class="fa-solid fa-chart-pie"></i> Overview</a>
        <a href="/dashboard/<%= guild.id %>/moderation" class="nav-item <%= module === 'moderation' ? 'active' : '' %>"><i class="fa-solid fa-shield-halved"></i> Moderation</a>
        <a href="/dashboard/<%= guild.id %>/levels" class="nav-item <%= module === 'levels' ? 'active' : '' %>"><i class="fa-solid fa-chart-line"></i> Levels</a>
        <a href="/dashboard/<%= guild.id %>/giveaway" class="nav-item <%= module === 'giveaway' ? 'active' : '' %>"><i class="fa-solid fa-gift"></i> Giveaways</a>
        <a href="/dashboard/<%= guild.id %>/suggestion" class="nav-item <%= module === 'suggestion' ? 'active' : '' %>"><i class="fa-solid fa-lightbulb"></i> Suggestions</a>
        <a href="/dashboard/<%= guild.id %>/welcome" class="nav-item <%= module === 'welcome' ? 'active' : '' %>"><i class="fa-solid fa-door-open"></i> Welcome</a>

        <span class="menu-label">System</span>
        <a href="/dashboard/<%= guild.id %>/tickets" class="nav-item <%= module === 'tickets' ? 'active' : '' %>"><i class="fa-solid fa-ticket"></i> Ticket System</a>
        <a href="/dashboard/<%= guild.id %>/registration" class="nav-item <%= module === 'registration' ? 'active' : '' %>"><i class="fa-solid fa-id-card"></i> Regist System</a>
        <a href="/dashboard/<%= guild.id %>/logging" class="nav-item <%= module === 'logging' ? 'active' : '' %>"><i class="fa-solid fa-file-lines"></i> Logging</a>
        <a href="/dashboard/<%= guild.id %>/invites" class="nav-item <%= module === 'invites' ? 'active' : '' %>"><i class="fa-solid fa-user-plus"></i> Invite Tracker</a>
        <a href="/dashboard/<%= guild.id %>/jtc" class="nav-item <%= module === 'jtc' ? 'active' : '' %>"><i class="fa-solid fa-microphone"></i> JTC System</a>
        <a href="/dashboard/<%= guild.id %>/social_notify" class="nav-item <%= module === 'social_notify' ? 'active' : '' %>"><i class="fa-solid fa-share-nodes"></i> Social Notify</a>

        <span class="menu-label" style="color: var(--accent);">Entertainment</span>
        <a href="/dashboard/<%= guild.id %>/wordgame" class="nav-item <%= module === 'wordgame' ? 'active' : '' %>"><i class="fa-solid fa-font"></i> Word Game</a>
        <a href="/dashboard/<%= guild.id %>/counting" class="nav-item <%= module === 'counting' ? 'active' : '' %>"><i class="fa-solid fa-list-ol"></i> Counting Game</a>
        <a href="/dashboard/<%= guild.id %>/economy" class="nav-item <%= module === 'economy' ? 'active' : '' %>"><i class="fa-solid fa-coins"></i> Economy</a>

        <a href="/settings" class="nav-item back-btn"><i class="fa-solid fa-arrow-left"></i> Change Server</a>
    </aside>

    <main class="main-content">
        <div class="module-header">
            <div class="header-left">
                <div class="header-icon"><i class="fa-solid <%= config.icon %>"></i></div>
                <div class="header-text">
                    <h1><%= config.title %></h1>
                    <p><%= config.desc %></p>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <div class="user-pill">
                    <img src="https://cdn.discordapp.com/avatars/<%= discordUser.id %>/<%= discordUser.avatar %>.png" class="user-avatar">
                    <div class="user-name"><%= discordUser.username %></div>
                </div>
                <button class="save-btn" onclick="saveSettings()">
                    <i class="fa-solid fa-floppy-disk"></i> Save Changes
                </button>
            </div>
        </div>

        <form id="settingsForm" class="settings-container">
            <% config.settings.forEach(setting => { %>
                <div class="setting-card">
                    <% if (setting.type === 'toggle') { %>
                        <div class="toggle-wrapper">
                            <div class="form-group">
                                <label class="form-label"><%= setting.label %></label>
                                <span style="font-size: 0.9rem; color: #94a3b8;">Enable or disable this feature.</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="<%= setting.id %>" <%= setting.value ? 'checked' : '' %>>
                                <span class="slider"></span>
                            </label>
                        </div>
                    <% } else if (setting.type === 'textarea') { %>
                        <div class="form-group">
                            <label class="form-label"><%= setting.label %></label>
                            <% if (setting.withEmoji) { %>
                                <div class="input-with-emoji">
                                    <textarea class="form-textarea" name="<%= setting.id %>" placeholder="<%= setting.placeholder || '' %>"><%= setting.value || '' %></textarea>
                                    <button type="button" class="emoji-trigger-btn" onclick="openEmojiPicker(this)"><i class="fa-regular fa-face-smile"></i></button>
                                </div>
                            <% } else { %>
                                <textarea class="form-textarea" name="<%= setting.id %>" placeholder="<%= setting.placeholder || '' %>"><%= setting.value || '' %></textarea>
                            <% } %>
                        </div>
                    <% } else if (setting.type === 'text') { %>
                        <div class="form-group">
                            <label class="form-label"><%= setting.label %></label>
                            <% if (setting.withEmoji) { %>
                                <div class="input-with-emoji">
                                    <input type="text" class="form-input" name="<%= setting.id %>" placeholder="<%= setting.placeholder || '' %>" value="<%= setting.value || '' %>">
                                    <button type="button" class="emoji-trigger-btn" onclick="openEmojiPicker(this)"><i class="fa-regular fa-face-smile"></i></button>
                                </div>
                            <% } else { %>
                                <input type="text" class="form-input" name="<%= setting.id %>" placeholder="<%= setting.placeholder || '' %>" value="<%= setting.value || '' %>">
                            <% } %>
                        </div>
                    <% } else if (setting.type === 'select') { %>
                        <div class="form-group">
                            <label class="form-label"><%= setting.label %></label>
                            <select class="form-select" name="<%= setting.id %>">
                                <% setting.options.forEach(opt => { %>
                                    <option value="<%= opt %>" <%= setting.value === opt ? 'selected' : '' %>><%= opt %></option>
                                <% }) %>
                            </select>
                        </div>
                    <% } else if (setting.type === 'role_select') { %>
                        <div class="form-group">
                            <label class="form-label"><%= setting.label %></label>
                            <select class="form-select" name="<%= setting.id %>">
                                <option value="" disabled <%= !setting.value ? 'selected' : '' %>>Select a Role...</option>
                                <% roleList.forEach(role => { %>
                                    <option value="<%= role.id %>" style="color: <%= role.color !== '#000000' ? role.color : 'white' %>;" <%= setting.value === role.id ? 'selected' : '' %>>@<%= role.name %></option>
                                <% }) %>
                            </select>
                        </div>
                    <% } else if (setting.type === 'channel_select') { %>
                        <div class="form-group">
                            <label class="form-label"><%= setting.label %></label>
                            <select class="form-select" name="<%= setting.id %>">
                                <option value="" disabled <%= !setting.value ? 'selected' : '' %>>Select a Channel...</option>
                                <% channelList.forEach(channel => { %>
                                    <option value="<%= channel.id %>" <%= setting.value === channel.id ? 'selected' : '' %>><%= channel.type === 'voice' ? 'ðŸ”Š' : '#' %> <%= channel.name %></option>
                                <% }) %>
                            </select>
                        </div>
                    <% } %>
                </div>
            <% }) %>

            <% if (module === 'moderation') { %>
                <script>/* Jail grid kodlarÄ± eklenebilir */</script>
            <% } %>
        </form>
    </main>

    <div class="emoji-modal-overlay" id="emojiOverlay">
        <div class="emoji-modal">
            <div class="emoji-header">
                <button class="emoji-tab active" onclick="switchTab('server')">Server Emojis</button>
                <button class="emoji-tab" onclick="switchTab('default')">Default</button>
                <button class="close-emoji-btn" onclick="closeEmojiPicker()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="emoji-content" id="serverEmojiList">
                <div class="emoji-grid">
                    <% if (emojiList && emojiList.length > 0) { %>
                        <% emojiList.forEach(emoji => { %>
                            <div class="emoji-item" onclick="insertEmoji('<%= emoji.string %>')"><img src="<%= emoji.url %>" alt="<%= emoji.name %>"></div>
                        <% }) %>
                    <% } %>
                </div>
            </div>
            <div class="emoji-content" id="defaultEmojiList" style="display: none;"><div class="emoji-grid" id="defaultGrid"></div></div>
        </div>
    </div>

    <script>
        // JS FonksiyonlarÄ± (saveSettings, emoji vb.) Ã¶nceki ile aynÄ±
        async function saveSettings() {
            const btn = document.querySelector('.save-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Saving...';
            btn.style.opacity = '0.7';
            btn.disabled = true;
            try {
                const form = document.getElementById('settingsForm');
                const formData = new FormData(form);
                const data = {};
                formData.forEach((value, key) => { data[key] = value; });
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(chk => { data[chk.name] = chk.checked; });
                
                // Jail verileri (eÄŸer varsa)
                if(document.getElementById('jailSetupProcess')) {
                    data.jail_setup_process = document.getElementById('jailSetupProcess').value === 'true';
                    data.jail_channel = document.getElementById('inputJailChannel').value;
                    data.jail_role = document.getElementById('inputJailRole').value;
                }

                const response = await fetch(window.location.pathname + '/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.success) {
                    btn.innerHTML = '<i class="fa-solid fa-check"></i> Saved!';
                    btn.style.background = '#10b981';
                } else { throw new Error('Error'); }
            } catch (error) {
                console.error(error);
                btn.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i> Error';
                btn.style.background = '#ef4444';
            }
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = '#10b981';
                btn.style.opacity = '1';
                btn.disabled = false;
            }, 2000);
        }

        let currentInput = null;
        const commonEmojis = ['ðŸ˜€','ðŸ˜ƒ','ðŸ˜„','ðŸ˜','ðŸ˜†','ðŸ˜…','ðŸ¤£','ðŸ˜‚','ðŸ™‚','ðŸ™ƒ','ðŸ˜‰','ðŸ˜Š','ðŸ˜‡','ðŸ¥°','ðŸ˜','ðŸ¤©','ðŸ˜˜','ðŸ˜—','ðŸ˜š','ðŸ˜™','ðŸ˜‹','ðŸ˜›','ðŸ˜œ','ðŸ¤ª','ðŸ˜','ðŸ¤‘','ðŸ¤—','ðŸ¤­','ðŸ¤«','ðŸ¤”','ðŸ¤','ðŸ¤¨','ðŸ˜','ðŸ˜‘','ðŸ˜¶','ðŸ˜','ðŸ˜’','ðŸ™„','ðŸ˜¬','ðŸ¤¥','ðŸ˜Œ','ðŸ˜”','ðŸ˜ª','ðŸ¤¤','ðŸ˜´','ðŸ˜·','ðŸ¤’','ðŸ¤•','ðŸ¤¢','ðŸ¤®','ðŸ¤§','ðŸ¥µ','ðŸ¥¶','ðŸ¥´','ðŸ˜µ','ðŸ¤¯','ðŸ¤ ','ðŸ¥³','ðŸ˜Ž','ðŸ¤“','ðŸ§','ðŸ˜•','ðŸ˜Ÿ','ðŸ™','â˜¹ï¸','ðŸ˜®','ðŸ˜¯','ðŸ˜²','ðŸ˜³','ðŸ¥º','ðŸ˜¦','ðŸ˜§','ðŸ˜¨','ðŸ˜°','ðŸ˜¥','ðŸ˜¢','ðŸ˜­','ðŸ˜±','ðŸ˜–','ðŸ˜£','ðŸ˜ž','ðŸ˜“','ðŸ˜©','ðŸ˜«','ðŸ¥±','ðŸ˜¤','ðŸ˜¡','ðŸ˜ ','ðŸ¤¬','ðŸ˜ˆ','ðŸ‘¿','ðŸ’€','â˜ ï¸','ðŸ’©','ðŸ¤¡','ðŸ‘¹','ðŸ‘º','ðŸ‘»','ðŸ‘½','ðŸ‘¾','ðŸ¤–','ðŸ˜º','ðŸ˜¸','ðŸ˜»','ðŸ˜¼','ðŸ˜½','ðŸ™€','ðŸ˜¿','ðŸ˜¾','ðŸ™ˆ','ðŸ™‰','ðŸ™Š','ðŸ‘‹','ðŸ¤š','ðŸ–','âœ‹','ðŸ––','ðŸ‘Œ','ðŸ¤Œ','ðŸ¤','âœŒï¸','ðŸ¤ž','ðŸ¤Ÿ','ðŸ¤˜','ðŸ¤™','ðŸ‘ˆ','ðŸ‘‰','ðŸ‘†','ðŸ‘‡','ðŸ‘','ðŸ‘Ž','âœŠ','ðŸ‘Š','ðŸ¤›','ðŸ¤œ','ðŸ‘','ðŸ™Œ','ðŸ‘','ðŸ¤²','ðŸ¤','ðŸ™','âœï¸','ðŸ’…','ðŸ¤³','ðŸ’ª'];
        const defaultGrid = document.getElementById('defaultGrid');
        commonEmojis.forEach(emoji => {
            const div = document.createElement('div');
            div.className = 'emoji-item';
            div.innerText = emoji;
            div.onclick = () => insertEmoji(emoji);
            defaultGrid.appendChild(div);
        });
        function openEmojiPicker(btn) { currentInput = btn.previousElementSibling; document.getElementById('emojiOverlay').classList.add('active'); }
        function closeEmojiPicker() { document.getElementById('emojiOverlay').classList.remove('active'); currentInput = null; }
        document.getElementById('emojiOverlay').onclick = function(e) { if (e.target === this) closeEmojiPicker(); }
        function switchTab(tab) {
            const serverList = document.getElementById('serverEmojiList');
            const defaultList = document.getElementById('defaultEmojiList');
            const tabs = document.querySelectorAll('.emoji-tab');
            if (tab === 'server') { serverList.style.display = 'block'; defaultList.style.display = 'none'; tabs[0].classList.add('active'); tabs[1].classList.remove('active'); } 
            else { serverList.style.display = 'none'; defaultList.style.display = 'block'; tabs[0].classList.remove('active'); tabs[1].classList.add('active'); }
        }
        function insertEmoji(emoji) {
            if (!currentInput) return;
            const start = currentInput.selectionStart;
            const end = currentInput.selectionEnd;
            const text = currentInput.value;
            if (currentInput.tagName === 'TEXTAREA' || currentInput.type === 'text') {
                const before = text.substring(0, start);
                const after = text.substring(end, text.length);
                currentInput.value = before + emoji + after;
                currentInput.selectionStart = currentInput.selectionEnd = start + emoji.length;
                currentInput.focus();
            } else { currentInput.value += emoji; }
            closeEmojiPicker();
        }
    </script>
</body>
</html>